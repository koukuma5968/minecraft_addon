{"version":3,"sources":["../../scripts/dorokei_script.ts","../../scripts/item/KeibouComponent.ts","../../scripts/block/SystemBoardBlock.ts","../../scripts/monitor/SystemMonitorTick.ts","../../scripts/custom/DorokeiCustomComponentRegistry.ts"],"sourcesContent":["import { system } from \"@minecraft/server\";\r\nimport { initRegisterDorokeiCustom } from \"./custom/DorokeiCustomComponentRegistry\";\r\n\r\n// ワールド起動時\r\nsystem.beforeEvents.startup.subscribe(initEvent => {\r\n  initRegisterDorokeiCustom(initEvent);\r\n});\r\n\r\n","import { ItemCustomComponent, ItemComponentHitEntityEvent, world} from \"@minecraft/server\";\r\n\r\nexport class KeibouComponent implements ItemCustomComponent {\r\n\r\n    // 攻撃ヒット\r\n    onHitEntity(event:ItemComponentHitEntityEvent) {\r\n        const hitEntity = event.hitEntity;\r\n        world.sendMessage(hitEntity.typeId);\r\n    }\r\n\r\n}\r\n","import { BlockCustomComponent, BlockComponentPlayerInteractEvent, Block, Player, BlockVolume, world, system, BlockStates, BlockPermutation, DisplaySlotId } from \"@minecraft/server\";\r\nimport { ModalFormData } from \"@minecraft/server-ui\";\r\nimport { SystemMonitorTick } from \"../monitor/SystemMonitorTick\";\r\n\r\nconst systemMonitorTick = new SystemMonitorTick();\r\n\r\n/**\r\n * システムブロック\r\n */\r\nexport class SystemBoardBlock implements BlockCustomComponent {\r\n\r\n    onPlayerInteract(event:BlockComponentPlayerInteractEvent) {\r\n        const block = event.block as Block;\r\n        const player = event.player as Player;\r\n\r\n        const modalForm = new ModalFormData().title({ translate: \"msg.kurokumaft:systemblock.title\"});\r\n\r\n        modalForm.label({translate: \"msg.kurokumaft:systemblock.field.range.label\"});\r\n        modalForm.slider({ translate: \"msg.kurokumaft:systemblock.field.down.text\"}, 1, 64, {\r\n            defaultValue:1\r\n        });\r\n        modalForm.slider({ translate: \"msg.kurokumaft:systemblock.field.range.text\"}, 24, 256, {\r\n            defaultValue:24\r\n        });\r\n\r\n        modalForm\r\n            .show(player)\r\n            .then((formData) => {\r\n                const values = formData.formValues;\r\n                if (values != undefined) {\r\n                    const fieldDown = values[1] as number;\r\n                    const fieldRange = values[2] as number;\r\n\r\n                    if (block.location.y-fieldDown < -63) {\r\n                        throw ({ translate: \"error.kurokumaft:systemblock.field.down.max_orver\"});\r\n                    }\r\n\r\n                    systemMonitorTick.startMonitoring(fieldRange.toString(), fieldDown.toString());\r\n                }\r\n            })\r\n            .catch((error: Error) => {\r\n                world.sendMessage(error.message);\r\n                console.log(error.stack);\r\n                \r\n            return -1;\r\n        });\r\n    }\r\n\r\n}\r\n\r\n","import { system, TicksPerSecond, world } from \"@minecraft/server\";\r\n\r\nexport class SystemMonitorTick {\r\n\r\n    num: number;\r\n\r\n    constructor() {\r\n        this.num = 0;\r\n    }\r\n\r\n    startMonitoring(fieldRange: string, fieldDown: string) {\r\n        if (this.num != 0) {\r\n            system.clearRun(this.num);\r\n        }\r\n\r\n        this.num = system.runInterval(() => {\r\n            try {\r\n                this.checkPlayerKaikyuTick(fieldRange, fieldDown);\r\n            } catch(error) {\r\n                system.clearRun(this.num);\r\n            }\r\n        }, 0.5*TicksPerSecond);\r\n    }\r\n\r\n    async checkPlayerKaikyuTick(fieldRange: string, fieldDown: string) {\r\n\r\n        world.getAllPlayers().forEach(player => {\r\n            if (player.isValid) {\r\n                player.onScreenDisplay.setTitle(\r\n                    {\r\n                        rawtext:[\r\n                            {translate:\"screen.kurokumaft:systemblock.fieldRange\"},\r\n                            {text: fieldRange,},\r\n                            {text: \"\\n\"},\r\n                            {translate:\"screen.kurokumaft:systemblock.fieldDown\"},\r\n                            {text: fieldDown,},\r\n                        ]\r\n                    },\r\n                    {\r\n                        stayDuration: 100,\r\n                        fadeInDuration: 0,\r\n                        fadeOutDuration: 1,\r\n                        subtitle: \"\"\r\n                    }\r\n                );\r\n            }\r\n        });\r\n    };\r\n\r\n}\r\n","import { StartupEvent } from \"@minecraft/server\";\r\nimport { KeibouComponent } from \"../item/KeibouComponent\";\r\nimport { SystemBoardBlock } from \"../block/SystemBoardBlock\";\r\n\r\n/**\r\n * カスタムコンポーネントの登録\r\n * @param {StartupEvent} initEvent\r\n */\r\nfunction initRegisterDorokeiCustom(initEvent:StartupEvent) {\r\n\r\n    // アイテム類\r\n    initEvent.itemComponentRegistry.registerCustomComponent(\"kurokumaft:keibou_component\", new KeibouComponent());\r\n\r\n    initEvent.blockComponentRegistry.registerCustomComponent(\"kurokumaft:systemboard_component\", new SystemBoardBlock());\r\n}\r\n\r\nexport {initRegisterDorokeiCustom}\r\n"],"mappings":";AAAA,SAAS,UAAAA,eAAc;;;ACAvB,SAA2D,aAAY;AAEhE,IAAM,kBAAN,MAAqD;AAAA;AAAA,EAGxD,YAAY,OAAmC;AAC3C,UAAM,YAAY,MAAM;AACxB,UAAM,YAAY,UAAU,MAAM;AAAA,EACtC;AAEJ;;;ACVA,SAA8F,SAAAC,cAAmE;AACjK,SAAS,qBAAqB;;;ACD9B,SAAS,QAAQ,gBAAgB,SAAAC,cAAa;AAEvC,IAAM,oBAAN,MAAwB;AAAA,EAI3B,cAAc;AACV,SAAK,MAAM;AAAA,EACf;AAAA,EAEA,gBAAgB,YAAoB,WAAmB;AACnD,QAAI,KAAK,OAAO,GAAG;AACf,aAAO,SAAS,KAAK,GAAG;AAAA,IAC5B;AAEA,SAAK,MAAM,OAAO,YAAY,MAAM;AAChC,UAAI;AACA,aAAK,sBAAsB,YAAY,SAAS;AAAA,MACpD,SAAQ,OAAO;AACX,eAAO,SAAS,KAAK,GAAG;AAAA,MAC5B;AAAA,IACJ,GAAG,MAAI,cAAc;AAAA,EACzB;AAAA,EAEA,MAAM,sBAAsB,YAAoB,WAAmB;AAE/D,IAAAA,OAAM,cAAc,EAAE,QAAQ,YAAU;AACpC,UAAI,OAAO,SAAS;AAChB,eAAO,gBAAgB;AAAA,UACnB;AAAA,YACI,SAAQ;AAAA,cACJ,EAAC,WAAU,2CAA0C;AAAA,cACrD,EAAC,MAAM,WAAW;AAAA,cAClB,EAAC,MAAM,KAAI;AAAA,cACX,EAAC,WAAU,0CAAyC;AAAA,cACpD,EAAC,MAAM,UAAU;AAAA,YACrB;AAAA,UACJ;AAAA,UACA;AAAA,YACI,cAAc;AAAA,YACd,gBAAgB;AAAA,YAChB,iBAAiB;AAAA,YACjB,UAAU;AAAA,UACd;AAAA,QACJ;AAAA,MACJ;AAAA,IACJ,CAAC;AAAA,EACL;AAEJ;;;AD7CA,IAAM,oBAAoB,IAAI,kBAAkB;AAKzC,IAAM,mBAAN,MAAuD;AAAA,EAE1D,iBAAiB,OAAyC;AACtD,UAAM,QAAQ,MAAM;AACpB,UAAM,SAAS,MAAM;AAErB,UAAM,YAAY,IAAI,cAAc,EAAE,MAAM,EAAE,WAAW,mCAAkC,CAAC;AAE5F,cAAU,MAAM,EAAC,WAAW,+CAA8C,CAAC;AAC3E,cAAU,OAAO,EAAE,WAAW,6CAA4C,GAAG,GAAG,IAAI;AAAA,MAChF,cAAa;AAAA,IACjB,CAAC;AACD,cAAU,OAAO,EAAE,WAAW,8CAA6C,GAAG,IAAI,KAAK;AAAA,MACnF,cAAa;AAAA,IACjB,CAAC;AAED,cACK,KAAK,MAAM,EACX,KAAK,CAAC,aAAa;AAChB,YAAM,SAAS,SAAS;AACxB,UAAI,UAAU,QAAW;AACrB,cAAM,YAAY,OAAO,CAAC;AAC1B,cAAM,aAAa,OAAO,CAAC;AAE3B,YAAI,MAAM,SAAS,IAAE,YAAY,KAAK;AAClC,gBAAO,EAAE,WAAW,oDAAmD;AAAA,QAC3E;AAEA,0BAAkB,gBAAgB,WAAW,SAAS,GAAG,UAAU,SAAS,CAAC;AAAA,MACjF;AAAA,IACJ,CAAC,EACA,MAAM,CAAC,UAAiB;AACrB,MAAAC,OAAM,YAAY,MAAM,OAAO;AAC/B,cAAQ,IAAI,MAAM,KAAK;AAE3B,aAAO;AAAA,IACX,CAAC;AAAA,EACL;AAEJ;;;AExCA,SAAS,0BAA0B,WAAwB;AAGvD,YAAU,sBAAsB,wBAAwB,+BAA+B,IAAI,gBAAgB,CAAC;AAE5G,YAAU,uBAAuB,wBAAwB,oCAAoC,IAAI,iBAAiB,CAAC;AACvH;;;AJVAC,QAAO,aAAa,QAAQ,UAAU,eAAa;AACjD,4BAA0B,SAAS;AACrC,CAAC;","names":["system","world","world","world","system"],"file":"../scripts/dorokei_script.js"}